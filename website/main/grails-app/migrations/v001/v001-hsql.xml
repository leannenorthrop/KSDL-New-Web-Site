<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9 http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">
    <preConditions>
            <dbms type="hsqldb" />
            <!-- These changes should only be run against a schema with major version 0 -->
            <sqlCheck expectedResult="0">
                SELECT NVL(MAX(id),0)
                FROM databasechangelog
                WHERE author='MajorVersion'
            </sqlCheck>
        </preConditions>
    <changeSet author="northrl" id="1">
        <createTable tableName="address">
            <column name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="post_code" type="VARCHAR(10)"/>
            <column name="place_name" type="VARCHAR(1024)"/>
            <column name="type" type="VARCHAR(5)"/>
            <column name="country" type="VARCHAR(108)"/>
            <column name="county" type="VARCHAR(25)"/>
            <column name="street_number" type="INT"/>
            <column name="line1" type="VARCHAR(1024)"/>
            <column name="post_town" type="VARCHAR(1024)"/>
            <column name="line2" type="VARCHAR(1024)"/>
        </createTable>
    </changeSet>
    <changeSet author="northrl" id="2">
        <createTable tableName="article">
            <column name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="summary" type="VARCHAR(1024)"/>
            <column name="image_id" type="BIGINT"/>
            <column name="content" type="VARCHAR(1024)"/>
            <column name="title" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet author="northrl" id="3">
        <createTable tableName="audit_log">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="property_name" type="VARCHAR(255)"/>
            <column name="last_updated" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="old_value" type="VARCHAR(255)"/>
            <column name="actor" type="VARCHAR(255)"/>
            <column name="uri" type="VARCHAR(255)"/>
            <column name="new_value" type="VARCHAR(255)"/>
            <column name="persisted_object_version" type="VARCHAR(255)"/>
            <column name="date_created" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="class_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="event_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="persisted_object_id" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet author="northrl" id="4">
        <createTable tableName="author">
            <column name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="personal_home_page" type="VARCHAR(255)"/>
            <column name="aka" type="VARCHAR(255)"/>
            <column name="interests" type="VARCHAR(1024)"/>
            <column name="about_me" type="VARCHAR(1024)"/>
        </createTable>
    </changeSet>
    <changeSet author="northrl" id="5">
        <createTable tableName="contact">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="northrl" id="6">
        <createTable tableName="email">
            <column name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="address" type="VARCHAR(255)"/>
            <column name="type" type="VARCHAR(5)"/>
        </createTable>
    </changeSet>
    <changeSet author="northrl" id="7">
        <createTable tableName="event">
            <column name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="summary" type="VARCHAR(1024)"/>
            <column name="once_only" type="BIT"/>
            <column name="image_id" type="BIGINT"/>
            <column name="content" type="VARCHAR(1024)"/>
            <column name="title" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet author="northrl" id="8">
        <createTable tableName="image">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="thumbnail" type="BLOB">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="image" type="BLOB">
                <constraints nullable="false"/>
            </column>
            <column name="mime_type" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="northrl" id="9">
        <createTable tableName="pending_email_confirmation">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="timestamp" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="user_token" type="VARCHAR(1024)"/>
            <column name="email_address" type="VARCHAR(80)">
                <constraints nullable="false"/>
            </column>
            <column name="confirmation_token" type="VARCHAR(80)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="northrl" id="10">
        <createTable tableName="person">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="last_name" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
            <column name="title_prefix" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="first_name" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
            <column name="title_suffix" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="profile_id" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="northrl" id="11">
        <createTable tableName="profile">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="northrl" id="12">
        <createTable tableName="profile_role">
            <column name="profile_roles_id" type="BIGINT"/>
            <column name="role_id" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="northrl" id="13">
        <createTable tableName="publishable">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="display_date" type="BIT"/>
            <column name="display_author" type="BIT"/>
            <column name="last_updated" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="deleted" type="BIT">
                <constraints nullable="false"/>
            </column>
            <column name="author_id" type="BIGINT"/>
            <column name="publish_state" type="VARCHAR(11)">
                <constraints nullable="false"/>
            </column>
            <column name="date_created" type="DATETIME">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="northrl" id="14">
        <createTable tableName="role">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="northrl" id="15">
        <createTable tableName="room">
            <column name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="image_id" type="BIGINT"/>
            <column name="description" type="VARCHAR(255)"/>
            <column name="name" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet author="northrl" id="16">
        <createTable tableName="shiro_role">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="northrl" id="17">
        <createTable tableName="shiro_role_permissions">
            <column name="shiro_role_id" type="BIGINT"/>
            <column name="permissions_string" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet author="northrl" id="18">
        <createTable tableName="shiro_user">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="username" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="person_id" type="BIGINT"/>
            <column name="password_hash" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="northrl" id="19">
        <createTable tableName="shiro_user_permissions">
            <column name="shiro_user_id" type="BIGINT"/>
            <column name="permissions_string" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet author="northrl" id="20">
        <createTable tableName="shiro_user_roles">
            <column name="shiro_user_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="shiro_role_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="northrl" id="21">
        <createTable tableName="tag_links">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="tag_ref" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="tag_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="type" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="northrl" id="22">
        <createTable tableName="tags">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="northrl" id="23">
        <createTable tableName="teacher">
            <column name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="bio" type="VARCHAR(1024)"/>
            <column name="blurb" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet author="northrl" id="24">
        <createTable tableName="telephone">
            <column name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="number" type="VARCHAR(255)"/>
            <column name="type" type="VARCHAR(6)"/>
        </createTable>
    </changeSet>
    <changeSet author="northrl" id="25">
        <createTable tableName="transport">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="northrl" id="26">
        <createTable tableName="venue_address">
            <column name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="northrl" id="27">
        <createTable tableName="venue_email">
            <column name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="northrl" id="28">
        <createTable tableName="venue_room">
            <column name="venue_rooms_id" type="BIGINT"/>
            <column name="room_id" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="northrl" id="29">
        <createTable tableName="venue_telephone">
            <column name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="northrl" id="30">
        <addPrimaryKey columnNames="shiro_user_id, shiro_role_id" tableName="shiro_user_roles"/>
    </changeSet>
    <changeSet author="northrl" id="31">
        <createIndex indexName="FKD458CCF6B776D63" tableName="article" unique="false">
            <column name="image_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="northrl" id="32">
        <createIndex indexName="title" tableName="article" unique="true">
            <column name="title"/>
        </createIndex>
    </changeSet>
    <changeSet author="northrl" id="33">
        <createIndex indexName="FK5C6729AB776D63" tableName="event" unique="false">
            <column name="image_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="northrl" id="34">
        <createIndex indexName="SYS_IDX_SYS_CT_142_145" tableName="event" unique="true">
            <column name="title"/>
        </createIndex>
    </changeSet>
    <changeSet author="northrl" id="35">
        <createIndex indexName="name" tableName="image" unique="true">
            <column name="name"/>
        </createIndex>
    </changeSet>
    <changeSet author="northrl" id="36">
        <createIndex indexName="emailconf_timestamp_Idx"
            tableName="pending_email_confirmation" unique="false">
            <column name="timestamp"/>
        </createIndex>
    </changeSet>
    <changeSet author="northrl" id="37">
        <createIndex indexName="emailconf_token_Idx"
            tableName="pending_email_confirmation" unique="false">
            <column name="confirmation_token"/>
        </createIndex>
    </changeSet>
    <changeSet author="northrl" id="38">
        <createIndex indexName="FKC4E39B5550FA9AAD" tableName="person" unique="false">
            <column name="profile_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="northrl" id="39">
        <createIndex indexName="FK48F2514C24914147"
            tableName="profile_role" unique="false">
            <column name="role_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="northrl" id="40">
        <createIndex indexName="FK48F2514C8C7A02EF"
            tableName="profile_role" unique="false">
            <column name="profile_roles_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="northrl" id="41">
        <createIndex indexName="FKDB6312E991252A7E"
            tableName="publishable" unique="false">
            <column name="author_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="northrl" id="42">
        <createIndex indexName="FK3580DBB776D63" tableName="room" unique="false">
            <column name="image_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="northrl" id="43">
        <createIndex indexName="SYS_IDX_SYS_CT_76_82" tableName="shiro_role" unique="true">
            <column name="name"/>
        </createIndex>
    </changeSet>
    <changeSet author="northrl" id="44">
        <createIndex indexName="FK389B46C981060810"
            tableName="shiro_role_permissions" unique="false">
            <column name="shiro_role_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="northrl" id="45">
        <createIndex indexName="FKE5884559602AC1A7"
            tableName="shiro_user" unique="false">
            <column name="person_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="northrl" id="46">
        <createIndex indexName="FK34555A9E2630CBF0"
            tableName="shiro_user_permissions" unique="false">
            <column name="shiro_user_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="northrl" id="47">
        <createIndex indexName="FKBA2210572630CBF0"
            tableName="shiro_user_roles" unique="false">
            <column name="shiro_user_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="northrl" id="48">
        <createIndex indexName="FKBA22105781060810"
            tableName="shiro_user_roles" unique="false">
            <column name="shiro_role_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="northrl" id="49">
        <createIndex indexName="FK7C35D6D45A3B441D"
            tableName="tag_links" unique="false">
            <column name="tag_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="northrl" id="50">
        <createIndex indexName="SYS_IDX_SYS_CT_88_103" tableName="tags" unique="true">
            <column name="name"/>
        </createIndex>
    </changeSet>
    <changeSet author="northrl" id="51">
        <createIndex indexName="FK9A9DFCAB7B485186"
            tableName="venue_room" unique="false">
            <column name="room_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="northrl" id="52">
        <createIndex indexName="FK9A9DFCABE524B5D5"
            tableName="venue_room" unique="false">
            <column name="venue_rooms_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="" id="53">
        <sql><![CDATA[
            INSERT INTO public.shiro_role (id,version,name) VALUES (1,1,'Admin');
            INSERT INTO public.shiro_role (id,version,name) VALUES (2,1,'Administrator');
            INSERT INTO public.shiro_role (id,version,name) VALUES (3,0,'Editor');
            INSERT INTO public.shiro_role (id,version,name) VALUES (4,0,'Author');
            INSERT INTO public.shiro_role (id,version,name) VALUES (5,1,'Event Organiser');
            INSERT INTO public.shiro_role (id,version,name) VALUES (6,0,'Venue Manager');

            INSERT INTO public.shiro_role_permissions (shiro_role_id,permissions_string) VALUES (1,'*:*');
            INSERT INTO public.shiro_role_permissions (shiro_role_id,permissions_string) VALUES (2,'admin:*');
            INSERT INTO public.shiro_role_permissions (shiro_role_id,permissions_string) VALUES (2,'manageSite:*');
            INSERT INTO public.shiro_role_permissions (shiro_role_id,permissions_string) VALUES (2,'auth:*');
            INSERT INTO public.shiro_role_permissions (shiro_role_id,permissions_string) VALUES (3,'manageSite:home');
            INSERT INTO public.shiro_role_permissions (shiro_role_id,permissions_string) VALUES (3,'article:*');
            INSERT INTO public.shiro_role_permissions (shiro_role_id,permissions_string) VALUES (4,'image:*');
            INSERT INTO public.shiro_role_permissions (shiro_role_id,permissions_string) VALUES (4,'article:*');
            INSERT INTO public.shiro_role_permissions (shiro_role_id,permissions_string) VALUES (4,'manageSite:home');
            INSERT INTO public.shiro_role_permissions (shiro_role_id,permissions_string) VALUES (5,'manageSite:home');
            INSERT INTO public.shiro_role_permissions (shiro_role_id,permissions_string) VALUES (5,'event:*');
            INSERT INTO public.shiro_role_permissions (shiro_role_id,permissions_string) VALUES (6,'manageSite:home');
            INSERT INTO public.shiro_role_permissions (shiro_role_id,permissions_string) VALUES (6,'room:*');
            INSERT INTO public.shiro_role_permissions (shiro_role_id,permissions_string) VALUES (6,'venue:*');

            INSERT INTO public.shiro_user (id,version,username,person_id,password_hash) VALUES (1,0,'leanne.northrop@googlemail.com',null,'f86c09c1159dc2082ee27f7aef08f1ed6a5be03d');
            INSERT INTO public.shiro_user (id,version,username,person_id,password_hash) VALUES (2,0,'web-admin',null,'f86c09c1159dc2082ee27f7aef08f1ed6a5be03d');

            INSERT INTO public.shiro_user_roles (shiro_user_id,shiro_role_id) VALUES (1,1);
            INSERT INTO public.shiro_user_roles (shiro_user_id,shiro_role_id) VALUES (2,2);
        ]]></sql>
        <rollback>
            delete * from table lsd.shiro_role;
            delete * from table lsd.shiro_role_permissions;
            delete * from table lsd.shiro_user;
            delete * from table lsd.shiro_user_roles;
        </rollback>
    </changeSet>
</databaseChangeLog>
